# ğŸ” AIé‚®ä»¶åŠ©æ‰‹æ€§èƒ½é—®é¢˜æ·±åº¦åˆ†ææŠ¥å‘Š

## ğŸ“Š **é—®é¢˜è¯Šæ–­æ€»ç»“**

### **ğŸš¨ æ ¹æœ¬åŸå› åˆ†æ**

ç»è¿‡æ·±å…¥çš„ä»£ç æ¶æ„åˆ†æï¼Œæˆ‘ä»¬å‘ç°äº†å¯¼è‡´æŒç»­åŠ è½½é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼š

#### **1. æ¶æ„å±‚é¢é—®é¢˜**
- **è¿‡åº¦å¤æ‚çš„ç»„ä»¶ç»“æ„**ï¼šå•ä¸ªç»„ä»¶è¿‡å¤§ï¼ˆLeadsManagement 849è¡Œï¼ŒProductMaterialsManager 394è¡Œï¼‰
- **ç¼ºä¹å…¨å±€çŠ¶æ€ç®¡ç†**ï¼šæ¯ä¸ªç»„ä»¶ç‹¬ç«‹ç®¡ç†çŠ¶æ€ï¼Œå¯¼è‡´é‡å¤è¯·æ±‚å’ŒçŠ¶æ€ä¸ä¸€è‡´
- **å®¢æˆ·ç«¯æ¸²æŸ“ç“¶é¢ˆ**ï¼šæ‰€æœ‰ç»„ä»¶éƒ½æ˜¯'use client'ï¼Œæ²¡æœ‰åˆ©ç”¨SSR/SSGä¼˜åŒ–åˆå§‹åŠ è½½
- **ä»£ç åˆ†å‰²ä¸è¶³**ï¼šå¤§å‹ç»„ä»¶æ²¡æœ‰æ‡’åŠ è½½ï¼Œå½±å“é¦–å±åŠ è½½æ—¶é—´

#### **2. æ•°æ®è·å–ç­–ç•¥é—®é¢˜**
- **ä¸²è¡Œæ•°æ®åŠ è½½**ï¼šç»„ä»¶æŒ‰é¡ºåºåŠ è½½æ•°æ®ï¼Œè€Œéå¹¶è¡Œè·å–
- **é‡å¤APIè°ƒç”¨**ï¼šç¼“å­˜ç­–ç•¥è™½ç„¶å®æ–½ï¼Œä½†é›†æˆä¸å®Œå–„
- **æ•°æ®åº“æŸ¥è¯¢ä½æ•ˆ**ï¼šå­˜åœ¨å›é€€é€»è¾‘ï¼ˆcustomer_leads -> leadsè¡¨ï¼‰ï¼Œå¢åŠ æŸ¥è¯¢æ—¶é—´
- **ç¼ºä¹æ•°æ®é¢„åŠ è½½**ï¼šæ²¡æœ‰åœ¨è·¯ç”±çº§åˆ«é¢„åŠ è½½å…³é”®æ•°æ®

#### **3. æ¸²æŸ“æ€§èƒ½é—®é¢˜**
- **é˜»å¡å¼æ¸²æŸ“**ï¼šå¤§å‹ç»„ä»¶çš„æ¸²æŸ“é˜»å¡äº†æ•´ä¸ªé¡µé¢
- **çŠ¶æ€æ›´æ–°é¢‘ç¹**ï¼šå¤šä¸ªuseStateå¯¼è‡´ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- **ç¼ºä¹è™šæ‹ŸåŒ–**ï¼šå¤§æ•°æ®é›†æ²¡æœ‰ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- **å†…å­˜æ³„æ¼é£é™©**ï¼šå¤æ‚çš„useEffectä¾èµ–å¯èƒ½å¯¼è‡´å†…å­˜é—®é¢˜

#### **4. ç½‘ç»œå±‚é¢é—®é¢˜**
- **APIç«¯ç‚¹è®¾è®¡ä¸ä¼˜åŒ–**ï¼šå•ä¸ªç«¯ç‚¹è¿”å›æ‰€æœ‰æ•°æ®ï¼Œè€Œéåˆ†é¡µæˆ–æŒ‰éœ€åŠ è½½
- **ç¼ºä¹è¯·æ±‚ä¼˜å…ˆçº§**ï¼šå…³é”®æ•°æ®å’Œéå…³é”®æ•°æ®åŒç­‰ä¼˜å…ˆçº§
- **é”™è¯¯å¤„ç†ä¸å®Œå–„**ï¼šç½‘ç»œé”™è¯¯å¯èƒ½å¯¼è‡´æ— é™åŠ è½½çŠ¶æ€

---

## ğŸ—ï¸ **æ¶æ„é‡æ–°è®¾è®¡æ–¹æ¡ˆ**

### **æ ¸å¿ƒè®¾è®¡åŸåˆ™**
1. **æ€§èƒ½ä¼˜å…ˆ**ï¼šæ¯ä¸ªè®¾è®¡å†³ç­–éƒ½ä»¥æ€§èƒ½ä¸ºé¦–è¦è€ƒè™‘
2. **æ¸è¿›å¼åŠ è½½**ï¼šä¼˜å…ˆåŠ è½½å…³é”®å†…å®¹ï¼Œå»¶è¿ŸåŠ è½½æ¬¡è¦åŠŸèƒ½
3. **çŠ¶æ€é›†ä¸­åŒ–**ï¼šä½¿ç”¨å…¨å±€çŠ¶æ€ç®¡ç†å‡å°‘é‡å¤è¯·æ±‚
4. **ç»„ä»¶åŸå­åŒ–**ï¼šå°†å¤§ç»„ä»¶æ‹†åˆ†ä¸ºå°çš„ã€å¯å¤ç”¨çš„åŸå­ç»„ä»¶

### **æŠ€æœ¯æ ˆä¼˜åŒ–**

#### **1. çŠ¶æ€ç®¡ç†å‡çº§**
```typescript
// ä» useState + useEffect å‡çº§åˆ° Zustand + React Query
import { create } from 'zustand'
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'

// å…¨å±€çŠ¶æ€ç®¡ç†
interface AppState {
  leads: Lead[]
  materials: ProductMaterial[]
  user: User | null
  loading: {
    leads: boolean
    materials: boolean
  }
}

const useAppStore = create<AppState>((set) => ({
  leads: [],
  materials: [],
  user: null,
  loading: { leads: false, materials: false }
}))

// æ•°æ®è·å–ä¼˜åŒ–
const useLeads = (userId: string) => {
  return useQuery({
    queryKey: ['leads', userId],
    queryFn: () => fetchLeads(userId),
    staleTime: 5 * 60 * 1000, // 5åˆ†é’Ÿç¼“å­˜
    cacheTime: 10 * 60 * 1000, // 10åˆ†é’Ÿå†…å­˜ç¼“å­˜
    refetchOnWindowFocus: false
  })
}
```

#### **2. ç»„ä»¶æ¶æ„é‡æ„**
```typescript
// åŸå­åŒ–ç»„ä»¶è®¾è®¡
// æ›¿æ¢å¤§å‹ LeadsManagement ç»„ä»¶

// å®¹å™¨ç»„ä»¶ - åªè´Ÿè´£æ•°æ®è·å–å’ŒçŠ¶æ€ç®¡ç†
const LeadsContainer = () => {
  const { data: leads, isLoading, error } = useLeads(user.id)
  
  if (isLoading) return <LeadsSkeleton />
  if (error) return <ErrorBoundary error={error} />
  
  return <LeadsView leads={leads} />
}

// å±•ç¤ºç»„ä»¶ - åªè´Ÿè´£UIæ¸²æŸ“
const LeadsView = ({ leads }: { leads: Lead[] }) => {
  return (
    <div className="space-y-4">
      <LeadsHeader />
      <LeadsFilters />
      <LeadsTable leads={leads} />
      <LeadsPagination />
    </div>
  )
}

// éª¨æ¶å±ç»„ä»¶ - æ”¹å–„æ„ŸçŸ¥æ€§èƒ½
const LeadsSkeleton = () => (
  <div className="space-y-4">
    {Array.from({ length: 5 }).map((_, i) => (
      <div key={i} className="animate-pulse bg-gray-200 h-16 rounded" />
    ))}
  </div>
)
```

#### **3. è·¯ç”±çº§æ•°æ®é¢„åŠ è½½**
```typescript
// app/dashboard/leads/page.tsx
import { dehydrate, HydrationBoundary, QueryClient } from '@tanstack/react-query'

export default async function LeadsPage() {
  const queryClient = new QueryClient()
  
  // æœåŠ¡å™¨ç«¯é¢„åŠ è½½æ•°æ®
  await queryClient.prefetchQuery({
    queryKey: ['leads'],
    queryFn: () => fetchLeadsSSR()
  })
  
  return (
    <HydrationBoundary state={dehydrate(queryClient)}>
      <LeadsContainer />
    </HydrationBoundary>
  )
}
```

#### **4. APIä¼˜åŒ–ç­–ç•¥**
```typescript
// åˆ†é¡µå’Œè¿‡æ»¤ä¼˜åŒ–
export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url)
  const page = parseInt(searchParams.get('page') || '1')
  const limit = parseInt(searchParams.get('limit') || '20')
  const status = searchParams.get('status')
  const search = searchParams.get('search')
  
  let query = supabase
    .from('customer_leads')
    .select('*', { count: 'exact' })
    .range((page - 1) * limit, page * limit - 1)
    .order('created_at', { ascending: false })
  
  if (status && status !== 'all') {
    query = query.eq('status', status)
  }
  
  if (search) {
    query = query.or(`customer_name.ilike.%${search}%,customer_email.ilike.%${search}%`)
  }
  
  const { data, error, count } = await query
  
  return NextResponse.json({
    success: true,
    data,
    pagination: {
      page,
      limit,
      total: count,
      totalPages: Math.ceil((count || 0) / limit)
    }
  })
}
```

---

## ğŸš€ **å®æ–½è®¡åˆ’**

### **é˜¶æ®µ1ï¼šåŸºç¡€æ¶æ„é‡æ„ (1-2å‘¨)**
1. **å®‰è£…æ–°ä¾èµ–**
   ```bash
   npm install zustand @tanstack/react-query
   npm install @tanstack/react-query-devtools
   ```

2. **åˆ›å»ºå…¨å±€çŠ¶æ€ç®¡ç†**
   - è®¾ç½®Zustand store
   - é…ç½®React Query
   - å®æ–½é”™è¯¯è¾¹ç•Œ

3. **APIç«¯ç‚¹ä¼˜åŒ–**
   - æ·»åŠ åˆ†é¡µæ”¯æŒ
   - å®æ–½æœç´¢å’Œè¿‡æ»¤
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢

### **é˜¶æ®µ2ï¼šç»„ä»¶é‡æ„ (2-3å‘¨)**
1. **æ‹†åˆ†å¤§å‹ç»„ä»¶**
   - LeadsManagement â†’ LeadsContainer + LeadsView + å­ç»„ä»¶
   - ProductMaterialsManager â†’ MaterialsContainer + MaterialsView + å­ç»„ä»¶

2. **å®æ–½éª¨æ¶å±**
   - ä¸ºæ‰€æœ‰ä¸»è¦ç»„ä»¶æ·»åŠ åŠ è½½çŠ¶æ€
   - æ”¹å–„æ„ŸçŸ¥æ€§èƒ½

3. **æ·»åŠ è™šæ‹ŸåŒ–**
   - å¯¹å¤§æ•°æ®é›†ä½¿ç”¨react-window
   - å®æ–½æ— é™æ»šåŠ¨

### **é˜¶æ®µ3ï¼šæ€§èƒ½ä¼˜åŒ– (1-2å‘¨)**
1. **ä»£ç åˆ†å‰²**
   - è·¯ç”±çº§ä»£ç åˆ†å‰²
   - ç»„ä»¶çº§æ‡’åŠ è½½

2. **ç¼“å­˜ç­–ç•¥**
   - å®æ–½å¤šå±‚ç¼“å­˜
   - ä¼˜åŒ–ç¼“å­˜å¤±æ•ˆç­–ç•¥

3. **ç›‘æ§å’Œåˆ†æ**
   - æ·»åŠ æ€§èƒ½ç›‘æ§
   - å®æ–½é”™è¯¯è¿½è¸ª

---

## ğŸ“ˆ **é¢„æœŸæ€§èƒ½æå‡**

| æŒ‡æ ‡ | å½“å‰çŠ¶æ€ | ç›®æ ‡çŠ¶æ€ | æ”¹è¿›å¹…åº¦ |
|------|----------|----------|----------|
| **é¦–å±åŠ è½½æ—¶é—´** | 10ç§’+ | <1ç§’ | â†‘1000% |
| **é¡µé¢äº¤äº’æ—¶é—´** | 5ç§’+ | <0.5ç§’ | â†‘1000% |
| **æ•°æ®è·å–æ—¶é—´** | 3-5ç§’ | <0.5ç§’ | â†‘600% |
| **å†…å­˜ä½¿ç”¨** | é«˜ | ä¼˜åŒ–50% | â†‘50% |
| **ç½‘ç»œè¯·æ±‚æ•°** | å¤šé‡å¤ | å‡å°‘70% | â†‘70% |

---

## ğŸ¯ **æˆåŠŸéªŒè¯æ ‡å‡†**

### **æ€§èƒ½æŒ‡æ ‡**
- âœ… å®¢æˆ·çº¿ç´¢é¡µé¢åœ¨2ç§’å†…å®Œå…¨åŠ è½½
- âœ… äº§å“èµ„æ–™é¡µé¢åœ¨2ç§’å†…å®Œå…¨åŠ è½½
- âœ… é¡µé¢äº¤äº’å“åº”æ—¶é—´<500ms
- âœ… é¦–å±å†…å®¹åœ¨1ç§’å†…å¯è§

### **ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**
- âœ… æ— æŒç»­åŠ è½½çŠ¶æ€
- âœ… æµç•…çš„é¡µé¢åˆ‡æ¢
- âœ… å³æ—¶çš„ç”¨æˆ·åé¦ˆ
- âœ… ä¼˜é›…çš„é”™è¯¯å¤„ç†

### **æŠ€æœ¯æŒ‡æ ‡**
- âœ… Core Web Vitalså…¨éƒ¨è¾¾åˆ°"Good"çº§åˆ«
- âœ… å†…å­˜ä½¿ç”¨ç¨³å®šï¼Œæ— æ³„æ¼
- âœ… ç½‘ç»œè¯·æ±‚ä¼˜åŒ–ï¼Œå‡å°‘é‡å¤è°ƒç”¨
- âœ… é”™è¯¯ç‡<1%

---

## ğŸ”§ **é£é™©è¯„ä¼°å’Œç¼“è§£ç­–ç•¥**

### **é«˜é£é™©é¡¹**
1. **æ•°æ®è¿ç§»é£é™©**
   - ç¼“è§£ï¼šæ¸è¿›å¼è¿ç§»ï¼Œä¿æŒå‘åå…¼å®¹
   - å¤‡ä»½ï¼šå®Œæ•´çš„æ•°æ®å¤‡ä»½å’Œå›æ»šè®¡åˆ’

2. **ç”¨æˆ·ä½“éªŒä¸­æ–­**
   - ç¼“è§£ï¼šåŠŸèƒ½æ ‡å¿—æ§åˆ¶ï¼ŒA/Bæµ‹è¯•
   - ç›‘æ§ï¼šå®æ—¶æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦

### **ä¸­é£é™©é¡¹**
1. **æ–°æŠ€æœ¯æ ˆå­¦ä¹ æ›²çº¿**
   - ç¼“è§£ï¼šå›¢é˜ŸåŸ¹è®­å’Œæ–‡æ¡£å®Œå–„
   - æ”¯æŒï¼šæŠ€æœ¯ä¸“å®¶æŒ‡å¯¼

2. **ç¬¬ä¸‰æ–¹ä¾èµ–é£é™©**
   - ç¼“è§£ï¼šé€‰æ‹©æˆç†Ÿç¨³å®šçš„åº“
   - å¤‡æ¡ˆï¼šå‡†å¤‡æ›¿ä»£æ–¹æ¡ˆ

---

## ğŸ“‹ **ä¸‹ä¸€æ­¥è¡ŒåŠ¨**

### **ç«‹å³æ‰§è¡Œ**
1. åˆ›å»ºæ€§èƒ½åŸºå‡†æµ‹è¯•
2. è®¾ç½®å¼€å‘ç¯å¢ƒ
3. å¼€å§‹åŸºç¡€æ¶æ„é‡æ„

### **æœ¬å‘¨å†…å®Œæˆ**
1. å®ŒæˆçŠ¶æ€ç®¡ç†è¿ç§»
2. å®æ–½ç¬¬ä¸€ä¸ªé‡æ„ç»„ä»¶
3. éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ

### **æŒç»­ç›‘æ§**
1. æ€§èƒ½æŒ‡æ ‡è¿½è¸ª
2. ç”¨æˆ·åé¦ˆæ”¶é›†
3. é”™è¯¯ç›‘æ§å’Œä¿®å¤

**ğŸ¯ ç›®æ ‡ï¼šåœ¨3-4å‘¨å†…å®Œæˆå…¨é¢é‡æ„ï¼Œå®ç°ç”Ÿäº§çº§æ€§èƒ½è¡¨ç°ï¼**
